!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cui-light",[],e):"object"==typeof exports?exports["cui-light"]=e():t["cui-light"]=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e=!0){return null!=t&&(!e||!function(t){if("string"==typeof t)return 0===t.length;if("boolean"==typeof t)return t;if(Array.isArray(t))return 0===t.length;return!1}(t))}function*r(){let t=0;for(;;){((yield t++)||t>2e5)&&(t=0)}}function o(t){return t?"string"==typeof t?t:t.id:null}n.r(e),n.d(e,"BpdEventBusFactory",(function(){return D})),n.d(e,"BpdEventBus",(function(){return K}));var s=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((i=i.apply(t,e||[])).next())}))};class u{execute(t,e,n){return s(this,void 0,void 0,(function*(){n=null!=n?n:[],i(e)?t.apply(e,n):t(...n)}))}}var a,l,c=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class f{constructor(){a.set(this,void 0),l.set(this,void 0),c(this,a,[]),c(this,l,[])}add(t,e){i(t)&&!this.has(t)&&(h(this,a).push(t),h(this,l).push(e))}remove(t){if(i(t)&&this.has(t)){let e=this.indexOf(t);e>-1&&(h(this,a).splice(e,1),h(this,l).splice(e,1))}}has(t){return h(this,a).includes(t)}get(t){return t>-1&&t<this.length()?{key:h(this,a)[t],value:h(this,l)[t]}:null}first(){return this.get(0)}length(){return h(this,a).length}indexOf(t){return h(this,a).indexOf(t)}}a=new WeakMap,l=new WeakMap;var d,p,v,g,y=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((i=i.apply(t,e||[])).next())}))},w=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},m=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class x{constructor(t,e,n){d.set(this,void 0),p.set(this,void 0),v.set(this,void 0),g.set(this,void 0),this.queue=new f,w(this,g,e),this.isBusy=!1,w(this,d,n),w(this,p,t),w(this,v,r())}handle(t,e,n,r){return y(this,void 0,void 0,(function*(){if(!i(e))return void this.logError("handle","No events provided");let o=this.createKey(t,r);if(this.queue.add(o,{events:e,id:n,args:r}),!this.isBusy){this.isBusy=!0;let t=null;for(;this.queue.length()>0;){t=this.queue.first();try{yield m(this,g).perform(t.value)}catch(t){this.logError("perform",t.message)}finally{this.queue.remove(t.key)}}this.isBusy=!1}return!0}))}logEvent(t,e){this.log("INFO",t,e)}logError(t,e){this.log("ERROR",t,e)}nextId(){return"#"+m(this,v).next().value}log(t,e,n){i(m(this,d))&&m(this,d).call(this,t,`[${m(this,p)}]-[${e}]`,(new Date).toLocaleString(),n)}}d=new WeakMap,p=new WeakMap,v=new WeakMap,g=new WeakMap;class E extends x{constructor(t){super("BasicEventEmitHandler",t)}createKey(t,e){return this.nextId()}}class b extends x{constructor(t,e){super("ExtendedEventEmitHandler",t)}createKey(t,e){let n=i(e)?e.length:0,r=null;if(n>0){if(1===e.length){let t=e[0];"string"==typeof t||"number"==typeof t||"boolean"==typeof t?r="s:"+t:t.id?r="ID:"+t.id:t.key&&(r="KEY:"+t.key)}return[t,n,null===r?JSON.stringify(e):r].join("-")}return[t,n].join("-")}}var M,k,O=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((i=i.apply(t,e||[])).next())}))},I=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},W=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class j{idMatches(t,e){return!i(t)||i(t)&&t==e}}class T extends j{constructor(t){super(),M.set(this,void 0),I(this,M,t)}perform(t){return O(this,void 0,void 0,(function*(){let e=null,n=null;for(let i in t.events)e=t.events[i],n=e.target?o(e.target):null,this.idMatches(t.id,n)&&(yield W(this,M).execute(e.callback,e.ctx,t.args));return!0}))}}M=new WeakMap;class B extends j{constructor(t){super(),k.set(this,void 0),I(this,k,t)}perform(t){return O(this,void 0,void 0,(function*(){let e=[],n=null,i=null;for(let r in t.events)n=t.events[r],i=n.target?o(n.target):null,this.idMatches(t.id,i)&&e.push(W(this,k).execute(n.callback,n.ctx,t.args));return yield Promise.all(e),!0}))}}k=new WeakMap;var P,S,A,R,$,_=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((i=i.apply(t,e||[])).next())}))},q=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},N=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class D{static create(t){let e=new u,n="tasked"===(null==t?void 0:t.policy)?new B(e):new T(e),r="extended"===(null==t?void 0:t.handling)?new b(n):new E(n),o=new K(r,null==t?void 0:t.name);return i(null==t?void 0:t.logger)&&o.setLogger(t.logger),o}}class K{constructor(t,e){P.set(this,void 0),S.set(this,void 0),A.set(this,void 0),R.set(this,void 0),$.set(this,void 0),q(this,P,{}),q(this,S,t),q(this,R,r()),q(this,$,null!=e?e:"EVENT_BUS")}setLogger(t){q(this,A,t)}on(t,e,n,r){(function(...t){if(!i(t))return!1;let e=t.length;for(let n=0;n<e;n++)if(!i(t[n]))return!1;return!0})(t,e)||this.logError("on","Missing argument");let s=this.prepareEventId(o(n));return this.logInfo("on",`Attaching new event: [${t}] for: [${s}]`),N(this,P)[t]||(N(this,P)[t]={}),N(this,P)[t][s]={ctx:n,callback:e,target:r},s}detach(t,e){i(t)||this.logError("detach","Missing argument");let n=N(this,P)[t],r=o(e);this.logInfo("detach",`Detaching item: [${r}] from [${t}]`),this.isAttached(n,r)&&delete n[r]}detachAll(t){i(t)&&N(this,P)[t]?delete N(this,P)[t]:this.logError("detachAll","Event name is missing or incorrect")}emit(t,e,...n){return _(this,void 0,void 0,(function*(){i(t)||this.logInfo("emit","Event name is incorrect");let r=o(e);return this.logInfo("emit",`Emit: [${t}], id: [${r}]`),yield N(this,S).handle(t,N(this,P)[t],r,n),!0}))}isSubscribing(t,e){let n=N(this,P)[t];return this.isAttached(n,o(e))}isAttached(t,e){return i(t)&&i(e)&&i(t[e])}prepareEventId(t){return i(t)?t:this.getRandomEventId()}logError(t,e){this.log("ERROR",t,e)}logInfo(t,e){this.log("INFO",t,e)}log(t,e,n){N(this,A)&&N(this,A).call(this,t,e,(new Date).toLocaleString(),n)}getRandomEventId(){return N(this,$)+"_"+N(this,R).next().value}}P=new WeakMap,S=new WeakMap,A=new WeakMap,R=new WeakMap,$=new WeakMap}])}));
//# sourceMappingURL=index.js.map