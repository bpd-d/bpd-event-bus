!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("bpd-event-bus",[],e):"object"==typeof exports?exports["bpd-event-bus"]=e():t["bpd-event-bus"]=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e=!0){return null!=t&&(!e||!function(t){if("string"==typeof t)return 0===t.length;if("boolean"==typeof t)return t;if(Array.isArray(t))return 0===t.length;return!1}(t))}function r(...t){if(!i(t))return!1;let e=t.length;for(let n=0;n<e;n++)if(!i(t[n]))return!1;return!0}function*s(){let t=0;for(;;){((yield t++)||t>2e5)&&(t=0)}}function o(t){return t?"string"==typeof t?t:t.eventId:null}n.r(e),n.d(e,"BPD_EVENT_BUS_VERSION",(function(){return Z}));var a=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((i=i.apply(t,e||[])).next())}))};class u{execute(t,e,n){return a(this,void 0,void 0,(function*(){n=null!=n?n:[],i(e)&&"string"!=typeof e?t.apply(e,n):t(...n)}))}}var h,c,l=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},f=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class d{constructor(){h.set(this,void 0),c.set(this,void 0),l(this,h,[]),l(this,c,[])}add(t,e){i(t)&&!this.has(t)&&(f(this,h).push(t),f(this,c).push(e))}remove(t){if(i(t)&&this.has(t)){let e=this.indexOf(t);e>-1&&(f(this,h).splice(e,1),f(this,c).splice(e,1))}}has(t){return f(this,h).includes(t)}get(t){return t>-1&&t<this.length()?{key:f(this,h)[t],value:f(this,c)[t]}:null}first(){return this.get(0)}length(){return f(this,h).length}indexOf(t){return f(this,h).indexOf(t)}}h=new WeakMap,c=new WeakMap;var p,v=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},g=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class w{constructor(t){p.set(this,void 0),v(this,p,t)}set(t){v(this,p,t)}get(){return g(this,p)}error(t,e){this.log("ERROR",t,e)}info(t,e){this.log("INFO",t,e)}log(t,e,n){g(this,p)&&g(this,p).call(this,t,e,(new Date).toLocaleString(),n)}}p=new WeakMap;var y,m,b,x=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((i=i.apply(t,e||[])).next())}))},E=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},M=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class k{constructor(t,e,n){y.set(this,void 0),m.set(this,void 0),b.set(this,void 0),this.queue=new d,E(this,b,e),this.isBusy=!1,E(this,y,new w(n)),E(this,m,s())}handle(t,e,n,r){return x(this,void 0,void 0,(function*(){if(!i(e))return M(this,y).error("handle","No events provided"),!1;let s=this.createKey(t,r);if(this.queue.add(s,{events:e,id:n,args:r}),!this.isBusy){this.isBusy=!0;let t=null;for(;this.queue.length()>0&&(t=this.queue.first(),t);)try{t.value&&(yield M(this,b).perform(t.value))}catch(t){M(this,y).error("perform",t.message)}finally{this.queue.remove(t.key)}this.isBusy=!1}return!0}))}nextId(){return"#"+M(this,m).next().value}}y=new WeakMap,m=new WeakMap,b=new WeakMap;class O extends k{constructor(t,e){super("BasicEventEmitHandler",t,e)}createKey(t,e){return this.nextId()}}class W extends k{constructor(t,e){super("ExtendedEventEmitHandler",t,e)}createKey(t,e){let n=i(e)?e.length:0,r=null;if(n>0){if(1===e.length){let t=e[0];"string"==typeof t||"number"==typeof t||"boolean"==typeof t?r="s:"+t:t.id?r="ID:"+t.id:t.key&&(r="KEY:"+t.key)}return[t,n,null===r?JSON.stringify(e):r].join("-")}return[t,n].join("-")}}var j,T,B=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((i=i.apply(t,e||[])).next())}))},S=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},P=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class A{idMatches(t,e){return!i(t)||i(t)&&t==e}}class I extends A{constructor(t){super(),j.set(this,void 0),S(this,j,t)}perform(t){return B(this,void 0,void 0,(function*(){let e=null,n=null;for(let i in t.events)e=t.events[i],n=e.target?o(e.target):null,this.idMatches(t.id,n)&&(yield P(this,j).execute(e.callback,e.ctx,t.args));return!0}))}}j=new WeakMap;class _ extends A{constructor(t){super(),T.set(this,void 0),S(this,T,t)}perform(t){return B(this,void 0,void 0,(function*(){let e=[],n=null,i=null;for(let r in t.events)n=t.events[r],i=o(n.target),this.idMatches(t.id,i)&&e.push(P(this,T).execute(n.callback,n.ctx,t.args));return yield Promise.all(e),!0}))}}T=new WeakMap;class $ extends Error{constructor(t,e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=t}}class D extends ${constructor(t){super("ArgumentError",t)}}var q,N,R,K,V,z,F,H,U,J,L=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((i=i.apply(t,e||[])).next())}))},X=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},Y=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class C{constructor(t,e,n){q.set(this,void 0),N.set(this,void 0),R.set(this,void 0),K.set(this,void 0),V.set(this,void 0),X(this,q,{}),X(this,N,t),X(this,K,s()),X(this,V,null!=e?e:"EVENT_BUS"),X(this,R,new w(n))}on(t,e,n){r(t,e)||Y(this,R).error("on","Missing argument");let i=this.prepareEventId(o(null==n?void 0:n.ctx));return Y(this,R).info("on",`Attaching new event: [${t}] for: [${i}]`),Y(this,q)[t]||(Y(this,q)[t]={}),Y(this,q)[t][i]={ctx:null==n?void 0:n.ctx,callback:e,target:null==n?void 0:n.target},i}detach(t,e){i(t)||Y(this,R).error("detach","Missing argument");let n=Y(this,q)[t],r=o(e);Y(this,R).info("detach",`Detaching item: [${r}] from [${t}]`),i(r)&&this.isAttached(n,r)&&delete n[r]}detachAll(t){i(t)&&Y(this,q)[t]?delete Y(this,q)[t]:Y(this,R).error("detachAll","Event name is missing or incorrect")}emit(t,e,...n){return L(this,void 0,void 0,(function*(){if(!i(t))throw new D("Event name is incorrect");let r=o(e);return Y(this,R).info("emit",`Emit: [${t}], id: [${r}]`),yield Y(this,N).handle(t,Y(this,q)[t],r,n),!0}))}isSubscribing(t,e){let n=Y(this,q)[t];return this.isAttached(n,o(e))}isAttached(t,e){return i(t)&&i(e)&&i(t[e])}prepareEventId(t){return i(t)?t:this.getRandomEventId()}getRandomEventId(){return Y(this,V)+"_"+Y(this,K).next().value}}q=new WeakMap,N=new WeakMap,R=new WeakMap,K=new WeakMap,V=new WeakMap;class G{constructor(t,e){if(z.set(this,void 0),F.set(this,void 0),H.set(this,void 0),U.set(this,void 0),J.set(this,void 0),X(this,J,"EXT"),X(this,U,new w(e)),X(this,F,[]),X(this,z,{}),X(this,H,0),i(t)){Y(this,U).info(Y(this,J),"Initiating buses"),(1===t.length?t:t.sort((t,e)=>t.priority-e.priority)).forEach((t,n)=>{Y(this,F).push(Q(t,e)),X(this,z,Object.assign(Object.assign({},Y(this,z)),this.mapEvents(t.eventsDef,n))),Y(this,U).info(Y(this,J),`Bus ${t.name} has been initialized with number: ${n}`)}),Y(this,F).push(Q({name:"Default",handling:"basic",policy:"tasked",eventsDef:[],priority:99},e)),X(this,H,Y(this,F).length-1),Y(this,U).info(Y(this,J),"Bus initialization finished")}}on(t,e,n){if(!r(t,e))throw new D("Missing argument");return this.get(t).on(t,e,n)}detach(t,e){if(!r(t,e))throw new D("Missing argument");this.get(t).detach(t,e)}detachAll(t){this.get(t).detachAll(t)}emit(t,e,...n){return L(this,void 0,void 0,(function*(){if(!i(t))throw new D("Event name is incorrect");return this.get(t).emit(t,e,...n)}))}isSubscribing(t,e){return this.get(t).isSubscribing(t,e)}mapEvents(t,e){return t.reduce((t,n)=>t[n]?t:Object.assign(Object.assign({},t),{[n]:e}),{})}get(t){let e=Y(this,z)[t];return Y(this,F)[null!=e?e:Y(this,H)]}}function Q(t,e){var n;if(!r(t.name,t.handling))throw new D("Bus name or handler name is incorrect");let i=function(t,e){return"tasked"===e?new _(t):new I(t)}(new u,t.policy),s=class{static get(t,e,n){switch(t){case"extended":return new W(e,n);default:return new O(e,n)}}}.get(null!==(n=t.handling)&&void 0!==n?n:"",i,e);return new C(s,t.name,e)}z=new WeakMap,F=new WeakMap,H=new WeakMap,U=new WeakMap,J=new WeakMap;const Z="0.1.3";window.$bpdEventBusVersion=Z,window.$bpdEvenBusFactory=class{static create(t){if(!t||!t.queue||0===t.queue.length)return Q({name:"Default",handling:"basic",policy:"tasked",eventsDef:[],priority:99});return new G(t.queue,t.logger)}}}])}));
//# sourceMappingURL=index.min.js.map